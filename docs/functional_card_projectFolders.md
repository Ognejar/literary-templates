# Карточка функционала: Система идентификации папок проектов

## Основная информация

| Параметр | Значение |
|----------|----------|
| **Название** | Система идентификации папок проектов |
| **Версия** | 1.0.0 |
| **Дата создания** | 2025-01-09 |
| **Статус** | Завершена |
| **Зависимости** | main.js, templates/Проекты.md |

## Описание
Система для различения папок проектов от обычных папок с использованием файла-маркера `Проекты.md`. Позволяет плагину корректно идентифицировать папки, предназначенные для хранения литературных проектов.

## Функции

### `isProjectFolder(app, folderPath)`
**Назначение**: Проверяет, является ли папка папкой проектов

**Параметры**:
- `app` - Экземпляр приложения Obsidian
- `folderPath` - Путь к папке для проверки

**Возвращает**: `boolean` - true если это папка проектов

**Логика**: Проверяет наличие файла `Проекты.md` в указанной папке

### `getAllProjectFolders(app)`
**Назначение**: Получает список всех папок проектов в хранилище

**Параметры**:
- `app` - Экземпляр приложения Obsidian

**Возвращает**: `Promise<string[]>` - Массив путей к папкам проектов

**Логика**: Сканирует все markdown файлы и ищет файлы с именем "Проекты"

## Файл-маркер

### `Проекты.md`
**Расположение**: В корне папки проектов
**Назначение**: Маркер, идентифицирующий папку как папку проектов

**Содержимое**:
- Описание назначения папки
- Структура проектов
- Типы поддерживаемых проектов
- Список файлов проекта

**Автоматическое создание**: При создании папки "Мои Проекты"

## Интеграция

### В `_selectProjectParentFolder()`
- Использует `getAllProjectFolders()` для поиска существующих папок проектов
- Приоритет отдается существующим папкам проектов
- Автоматически создает папку "Мои Проекты" с файлом-маркером

### В глобальной области видимости
- `window.isProjectFolder` - доступ к функции проверки
- `window.getAllProjectFolders` - доступ к функции получения списка

## Автоматические действия

### Создание папки "Мои Проекты"
1. Проверка существования папки
2. Создание папки если не существует
3. Создание файла-маркера `Проекты.md`
4. Использование шаблона или fallback контента

### Выбор папки для нового проекта
1. Поиск существующих папок проектов
2. Добавление "Мои Проекты" в список
3. Добавление других папок первого уровня
4. Показ списка пользователю для выбора

## Обработка ошибок

### Создание файла-маркера
- Try-catch блок для обработки ошибок
- Fallback контент если шаблон не найден
- Логирование ошибок для отладки

### Выбор папки
- Проверка существования папок
- Обработка отмены выбора пользователем
- Возврат null при ошибках

## Логирование

### Подробное логирование
- Количество найденных папок проектов
- Список папок для выбора
- Процесс создания папки "Мои Проекты"
- Создание файла-маркера
- Выбор пользователя

## Технические особенности

### Производительность
- Использует `getMarkdownFiles()` для быстрого поиска
- Фильтрация по имени файла на уровне JavaScript
- Минимальное количество обращений к файловой системе

### Совместимость
- Работает с существующими папками проектов
- Не нарушает работу с папками без маркера
- Обратная совместимость с текущей системой

## История изменений

### v1.0.0 (2025-01-09)
- Создание базовой системы идентификации
- Функции `isProjectFolder()` и `getAllProjectFolders()`
- Шаблон `Проекты.md`
- Интеграция с `_selectProjectParentFolder()`
- Автоматическое создание папки "Мои Проекты"

## Планы развития

### Возможные улучшения
- Поддержка вложенных папок проектов
- Кастомные маркеры для разных типов проектов
- Автоматическая миграция существующих папок
- Визуальные индикаторы папок проектов в интерфейсе

## Примеры использования

### Проверка папки проектов
```javascript
const isProject = isProjectFolder(app, 'Мои Проекты');
console.log(isProject); // true если папка содержит Проекты.md
```

### Получение списка папок проектов
```javascript
const projectFolders = await getAllProjectFolders(app);
console.log(projectFolders); // ['Мои Проекты', 'Другие проекты']
```

### Интеграция в плагин
```javascript
// В _selectProjectParentFolder()
const existingProjectFolders = await getAllProjectFolders(this.app);
// Использование для формирования списка выбора
```
