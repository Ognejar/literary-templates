# Карточка функционала - Функция createWorld

## Основная информация
- **Название**: createWorld.js + WorldWizardModal.js
- **Тип**: Мастер создания мира (проекта) с упрощенной структурой
- **Путь**: creators/createWorld.js, creators/WorldWizardModal.js
- **Версия**: 2.0.0
- **Статус**: Активен

## Описание функционала
Мастер создания нового мира/проекта с упрощенной структурой. Пользователь заполняет основные данные о мире через пошаговый интерфейс, после чего создается базовая структура проекта с папкой "Локации" и основными файлами.

## Параметры функции

### Входные параметры
| Параметр | Тип | Описание | Обязательный |
|----------|-----|----------|--------------|
| `plugin` | Object | Экземпляр плагина LiteraryTemplatesPlugin | Да |
| `worldData` | Object | Данные о мире из мастера | Да |
| `startPath` | string | Путь для создания проекта | Нет (по умолчанию: '') |

### Данные мастера (worldData)
| Параметр | Тип | Описание | Пример |
|----------|-----|----------|---------|
| `projectName` | string | Название проекта | "Мой мир" |
| `worldType` | string | Тип мира | "fantasy", "scifi", "historical" |
| `genre` | string | Жанр произведения | "Фэнтези" |
| `description` | string | Описание мира | "Мир магии и приключений..." |
| `mainTheme` | string | Главная тема | "Борьба добра и зла" |
| `secondaryThemes` | array | Второстепенные темы | ["Любовь", "Дружба"] |
| `author` | string | Автор произведения | "Иван Иванов" |
| `status` | string | Статус проекта | "в разработке" |

## Создаваемая структура

### Папки
| Папка | Путь | Назначение |
|-------|------|------------|
| Основная папка проекта | `{projectRoot}/{safeName}/` | Корневая папка проекта |
| Локации | `{projectRoot}/{safeName}/Локации/` | Папка для всех локаций |
| Персонажи | `{projectRoot}/{safeName}/Персонажи/` | Папка для персонажей |
| Сюжетные линии | `{projectRoot}/{safeName}/Сюжетные_линии/` | Папка для сюжетных линий |

### Файлы
| Файл | Путь | Шаблон | Назначение |
|------|------|--------|------------|
| Основной файл проекта | `{safeName}.md` | Новый_мир | Главная страница проекта |
| Настройки мира | `Настройки_мира.md` | - | Описание мира |
| Локации | `Локации/Локации.md` | - | Обзор локаций |
| Персонажи | `Персонажи/Персонажи.md` | - | Обзор персонажей |
| Сюжетные линии | `Сюжетные_линии/Сюжетные_линии.md` | - | Обзор сюжетных линий |

## Автоматические действия
- Создается папка мира с базовой структурой
- Создается управляющий файл мира по шаблону Новый_мир.md
- Создаются папки Локации, Персонажи, Сюжетные_линии и их overview-файлы
- Копируются все теговые картинки из папки плагина в папку мира
- Создается справочник писателя
- Новый мир автоматически становится активным проектом

> **Важно!** После создания мира рекомендуется перезапустить плагин или Obsidian, чтобы новые картинки стали видимы в файловом дереве и были доступны для вставки.

## Интеграция с системой

### Связь с шаблонами
- Использует шаблон "Новый_мир" для основного файла проекта
- Поддерживает плейсхолдеры {{...}} в шаблонах
- Применяет условную логику в шаблонах

### Связь с модальными окнами
- Использует WorldWizardModal для пошагового ввода данных
- Интеграция с HtmlWizardModal как базовым классом

### Связь с другими функциями
- Использует safeCreateFile для создания файлов с автонумерацией
- Использует generateFromTemplate для генерации контента
- Использует findProjectRoot для определения корня проекта
- Устанавливает созданный мир как активный проект

## Обработка ошибок

### Проверки
- Валидация данных мастера на каждом шаге
- Проверка существования папок перед созданием
- Обработка ошибок создания файлов с автонумерацией

### Логирование
- Детальное логирование всех этапов создания
- Запись ошибок в консоль
- Уведомления пользователя об успехе/ошибках

## История изменений

### [2025-08-29] - Кардинальная переделка v2.0.0
- Полностью переработан на базе мастера WorldWizardModal
- Убраны ненужные поля: setting, era, statuses, locationTypes, climates, races
- Убраны поля genders, peopleFeatures (перенесены в создаваемые народы)
- Упрощена структура создаваемых папок (только Локации)
- Добавлена пошаговая валидация данных
- Улучшена интеграция с системой автонумерации файлов

### [2025-01-09] - Добавление папки теговых картинок
- Добавлено автоматическое создание папки "Теговые_картинки"
- Улучшена структура создаваемых папок
- Добавлено логирование создания папки

### [2024-12-19] - Создание функции
- Базовая функциональность создания мира
- Система шаблонов типов миров
- Интеграция с системой шаблонов плагина

## Зависимости
- **Плагин**: Literary Templates
- **Шаблоны**: Новый_мир
- **Функции**: safeCreateFile, generateFromTemplate, findProjectRoot
- **Модальные окна**: WorldWizardModal, HtmlWizardModal
- **Система**: Автонумерация файлов, логирование

## Технические особенности
- Поддержка кириллицы в UTF-8
- Автоматическое создание папок и файлов
- Интеграция с Obsidian API
- Пошаговый мастер с валидацией данных
- Автонумерация файлов при конфликтах имен
- Установка созданного мира как активного проекта
