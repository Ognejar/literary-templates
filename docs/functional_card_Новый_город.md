# Карточка функционала: Новый_город.md

## Общая информация
- **Файл**: `templates/Новый_город.md`
- **Назначение**: Шаблон для создания городов в литературных проектах
- **Тип**: Основной шаблон локации
- **Зависимости**: `createCity.js`, `CityWizardModal.js`

## Структура шаблона

### Frontmatter
| Параметр | Тип | Описание | Пример |
|----------|-----|----------|--------|
| `created` | string | Дата создания | "2025-08-11" |
| `name` | string | Название города | "Хаген" |
| `aliases` | array | Альтернативные названия | ["Хаген", "Город торговцев"] |
| `type` | string | Тип локации | "Город" |
| `tags` | array | Теги для классификации | [place, город] |
| `project` | string | Название проекта | "заявсь" |
| `province` | string | Ссылка на провинцию | "Торвальд" |
| `climate` | string | Климатическая зона | "Умеренный" |
| `dominantFaction` | string | Доминирующая фракция | "Аристократия" |

### Основной контент

#### Изображение
- **Параметр**: `{{imageBlock}}`
- **Описание**: Автоматически найденное изображение города
- **Формат**: `![[путь_к_картинке]]`
- **Поиск**: В папке `Теговые_картинки` по типу города

#### Заголовок и основная информация
- **Заголовок**: `{{cityName}}` - название города
- **Тип**: `{{type}}` - тип локации (обычно "Город")
- **Климат**: `{{climate}}` - климатическая зона
- **Доминирующая фракция**: `{{dominantFaction}}` - основная фракция
- **Провинция**: `[[{{province}}]]` - ссылка на провинцию

#### Основные разделы
| Раздел | Параметр | Описание |
|--------|----------|----------|
| Описание | `{{description}}` | Подробное описание города |
| Основные отрасли | `{{mainIndustriesSection}}` | Экономические отрасли |
| Районы | `{{districtsSection}}` | Районы и кварталы города |
| Особенности | `{{featuresContent}}` | Общие особенности |
| Уникальные особенности | `{{uniqueFeaturesSection}}` | Специфические черты |

#### Автоматические связи
- **Dataview запрос**: Показывает все города в той же провинции
- **Фильтр**: `type = "Город" and province = this.province`

## Параметры из createCity.js

### Обязательные параметры
- `cityName` - название города
- `type` - тип локации
- `climate` - климат
- `dominantFaction` - доминирующая фракция
- `province` - провинция
- `description` - описание

### Опциональные параметры
- `mainIndustriesSection` - основные отрасли
- `districtsSection` - районы города
- `featuresContent` - особенности
- `uniqueFeaturesSection` - уникальные особенности

### Автоматически генерируемые
- `date` - дата создания
- `projectName` - название проекта
- `typeLower` - тип в нижнем регистре для тегов
- `imageBlock` - блок с изображением

## Интеграция с системой

### Связи с другими сущностями
- **Провинции**: Город привязан к провинции через поле `province`
- **Государства**: Связь через провинцию
- **Фракции**: Указана доминирующая фракция
- **Климаты**: Указан климат региона

### Dataview интеграция
- Автоматическое отображение связанных городов
- Фильтрация по типу и провинции
- Исключение текущего файла из списков

## Пример использования

```javascript
// В createCity.js
const data = {
    cityName: "Хаген",
    type: "Город",
    climate: "Умеренный",
    dominantFaction: "Аристократия",
    province: "Торвальд",
    description: "Крупный торговый город...",
    mainIndustriesSection: "- Торговля\n- Ремесло",
    districtsSection: "- Старый город\n- Торговый квартал",
    featuresContent: "- Крепостные стены\n- Большой рынок",
    uniqueFeaturesSection: "- Плавающий мост через реку",
    date: "2025-08-11",
    projectName: "заявсь",
    typeLower: "город",
    imageBlock: "![[Теговые_картинки/Город.jpg]]"
};
```

## История изменений
- **2025-01-09**: Полная интеграция с CityWizardModal
- **2024-12-19**: Упрощение шаблона, убраны избыточные условные блоки
- **2024-12-19**: Добавлена поддержка изображений через imageBlock
- **2024-12-19**: Создана первая версия шаблона

## Зависимости
- `createCity.js` - логика создания
- `CityWizardModal.js` - мастер ввода данных
- `settingsService.js` - получение настроек мира
- `Теговые_картинки/Город.jpg` - изображение города
