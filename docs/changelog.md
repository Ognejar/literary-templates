# Журнал изменений

## [2025-08-12] - Исправление предупреждений ESLint
### Изменено
- Обновлена обработка исключений с использованием optional catch binding в местах, где переменная ошибки не используется.

### Исправлено
- В `main.js` на строке с `catch (_){}` заменено на `catch {}` в методе `getActiveEditor()`.
- В `main.js` в методе `processSingleInclude()` заменено `catch (fsError){}` на `catch {}` для устранения предупреждения о неиспользуемой переменной.

## [2025-08-12] - Автодобавление ингредиентов в справочник
### Добавлено
- В мастер создания зелий добавлен переключатель «Добавлять новые ингредиенты в справочник» (по умолчанию включен).
- Автоматическая запись уникальных ингредиентов в `Магия/Справочники/Ингредиенты_зелий.md` при завершении мастера.

### Изменено
- Обновлен `PotionWizardModal.js` (шаг «Ингредиенты») и DocBlock `@updated`.
- Обновлен `createPotion.js`: логика чтения/слияния и сортировки списка ингредиентов.
 
### Исправлено
- В выводе зелий больше не попадает слово `manual` — для ингредиентов/эффектов/тегов/локаций при выборе «Ввести вручную» берётся текст из соответствующих полей.

## [2025-08-12] - Поддержка справочников для зелий и правка сложности
### Добавлено
- Поддержка справочников: `Сложности_зелий.md`, `Время_приготовления_зелий.md` в мастере зелий.
- Возможность выбирать из справочника или вводить вручную (для времени и сложности).
 - Новый справочник инструментов: `Инструменты_зельеварения.md`. Динамический список инструментов в мастере с добавлением по кнопке.

### Изменено
- Обновлен `PotionWizardModal.js` (шаг «Процесс приготовления») — выпадающие списки для времени и сложности.
- Обновлен `createPotion.js` — корректная подстановка при выборе «ручной ввод».

### Исправлено
- Уточнены формулировки сложности в женском роде: «Легкая», «Средняя», «Высокая», «Экспертная», «Мастерская».

## [2024-12-19] - Завершение системы магических функций
### Добавлено
- Создан модальный мастер для артефактов (`ArtifactWizardModal.js`)
- Создан модальный мастер для алхимических рецептов (`AlchemyRecipeWizardModal.js`)
- Добавлена функция создания артефактов (`createArtifact.js`)
- Добавлена функция создания алхимических рецептов (`createAlchemyRecipe.js`)
- Обновлен шаблон артефактов с поддержкой новых полей
- Создан новый шаблон алхимических рецептов
- Включены алхимические рецепты в контекстное меню

### Изменено
- Заменена старая функция `createArtifact` в main.js на новую модульную версию
- Обновлено меню "Магия" - все функции теперь активны

### Исправлено
- Удалена дублированная функция `createArtifact` из main.js

## [2024-12-19] - Завершение системы статусов для всех локаций
### Добавлено
- Система статусов (действует/заброшено/разрушено) для всех типов локаций
- Условное отображение производственных/экономических секций в зависимости от статуса
- Шаги статуса во всех модальных окнах создания локаций
- Поле "Причина" для заброшенных и разрушенных локаций

### Изменено
- Обновлены все шаблоны локаций для поддержки статусов
- Модифицированы все модальные окна для включения шага статуса
- Обновлены функции создания для передачи данных о статусе

### Исправлено
- Условные операторы в шаблонах теперь работают корректно
- Удалены дублированные включения секций
- Исправлены вложенные условные блоки

## [2024-12-19] - Реструктуризация контекстного меню
### Добавлено
- Иерархическая структура меню с подменю
- Группировка команд по категориям
- Разделители между разделами

### Изменено
- Перемещены основные разделы в начало меню
- Перемещены служебные функции в конец
- Улучшена навигация и логика меню

## [2024-12-19] - Команды вставки контента
### Добавлено
- Команда "Вставить TODO" для создания задач в текущем файле
- Команда "Вставить сюжетную линию в сцену" для вставки сюжетных линий
- Парсинг файла Сюжетные_линии.md
- Автоматическое определение типа сущности

### Изменено
- Улучшена функция `getActiveEditor` для безопасной работы с MarkdownView
- Добавлена поддержка различных форматов TODO

## [2024-12-19] - Dataview отчеты в главный файл проекта
### Добавлено
- Отчет "Локации по статусам"
- Отчет "Невыполненные задачи"
- Отчет "Пустые карточки"
- Отчет "Города и провинции"

### Изменено
- Главный файл проекта теперь содержит полезные отчеты для отслеживания прогресса

## [2024-12-19] - Исправление ошибок шаблонов
### Исправлено
- Обработка условных операторов {{#if status == действует}}
- Удаление дублированных включений {{include:sections/История.md}}
- Исправление вложенных условных блоков
- Улучшение обработки include-блоков
- Замена {{else if}} на независимые {{#if}} блоки

## [2024-12-19] - Планирование оптимизации системы шаблонов
### Добавлено
- Анализ текущей системы шаблонов
- Определение повторяющихся секций
- План перехода к include-блокам
- План унификации шаблонов

### Изменено
- Документирован план оптимизации системы шаблонов

## [2024-12-19] - Улучшение интерфейса алхимических рецептов

### Добавлено
- Динамический интерфейс для ввода ингредиентов с возможностью добавления/удаления
- Кнопка "+ Добавить ингредиент" для создания произвольного количества ингредиентов
- Кнопки удаления для каждого ингредиента (кроме последнего)
- Улучшенная валидация с проверкой наличия хотя бы одного ингредиента

### Изменено
- Переработан метод `renderIngredients()` в `AlchemyRecipeWizardModal.js`
- Добавлены методы `renderIngredientsList()` и `updateIngredientsData()`
- Обновлен метод `createRecipe()` для работы с новым форматом ингредиентов
- Улучшена валидация шага ингредиентов

### Исправлено
- Проблема с невозможностью ввода ингредиентов вручную
- Отсутствие справочника ингредиентов больше не является препятствием
