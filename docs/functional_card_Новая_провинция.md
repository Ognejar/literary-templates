# Карточка функционала: Новая_провинция.md

## Общая информация
- **Файл**: `templates/Новая_провинция.md`
- **Назначение**: Шаблон для создания провинций в литературных проектах
- **Тип**: Административный шаблон локации
- **Зависимости**: `createProvince.js`, `ProvinceWizardModal.js`

## Структура шаблона

### Frontmatter
| Параметр | Тип | Описание | Пример |
|----------|-----|----------|--------|
| `created` | string | Дата создания | "2025-08-11" |
| `name` | string | Название провинции | "Торвальд" |
| `aliases` | array | Альтернативные названия | ["Торвальд"] |
| `type` | string | Тип локации | "Провинция" |
| `tags` | array | Теги для классификации | [place, провинция] |
| `project` | string | Название проекта | "заявсь" |
| `climate` | string | Климатическая зона | "Умеренный" |
| `state` | string | Ссылка на государство | "Королевство_1" |
| `dominantFaction` | string | Доминирующая фракция | "Аристократия" |
| `historicalPeriod` | string | Исторический период | "Средневековье" |

### Основной контент

#### Изображение
- **Параметр**: `{{imageBlock}}`
- **Описание**: Автоматически найденное изображение провинции
- **Формат**: `![[путь_к_картинке]]`
- **Поиск**: В папке `Теговые_картинки` по типу "Провинция"

#### Заголовок и основная информация
- **Заголовок**: `{{name}}` - название провинции
- **Тип**: `{{type}}` - тип локации (обычно "Провинция")
- **Климат**: `{{climate}}` - климатическая зона
- **Государство**: `[[{{state}}]]` - ссылка на государство
- **Доминирующая фракция**: `{{dominantFaction}}` - основная фракция
- **Исторический период**: `{{historicalPeriod}}` - историческая эпоха

#### Основные разделы
| Раздел | Параметр | Описание |
|--------|----------|----------|
| Описание | `{{description}}` | Подробное описание провинции |
| Население | `{{population}}` | Демографическая информация |
| Экономика | `{{economy}}` | Экономическая структура |
| Второстепенные фракции | `{{minorFactionsSection}}` | Другие фракции в провинции |

#### Населённые пункты
| Тип | Параметр | Описание |
|-----|----------|----------|
| Города | `{{citiesSection}}` | Список городов провинции |
| Деревни | `{{villagesSection}}` | Список деревень провинции |

#### Особые территории
| Тип | Параметр | Описание |
|-----|----------|----------|
| Мёртвые зоны | `{{deadZonesSection}}` | Опасные территории |
| Порты | `{{portsSection}}` | Морские порты |
| Замки и крепости | `{{castlesSection}}` | Фортификации |

#### Автоматические связи
- **Фортификации**: `LIST FROM "" WHERE tags AND contains(tags, "фортификация") AND province = this.name`
- **Города провинции**: `LIST FROM "" WHERE type = "Город" AND province = this.name`
- **Деревни провинции**: `LIST FROM "" WHERE type = "Деревня" AND province = this.name`

## Параметры из createProvince.js

### Обязательные параметры
- `name` - название провинции
- `type` - тип локации
- `climate` - климат
- `state` - государство
- `dominantFaction` - доминирующая фракция
- `historicalPeriod` - исторический период
- `description` - описание

### Опциональные параметры
- `population` - демографическая информация
- `economy` - экономическая структура
- `minorFactionsSection` - второстепенные фракции
- `citiesSection` - список городов
- `villagesSection` - список деревень
- `deadZonesSection` - мёртвые зоны
- `portsSection` - порты
- `castlesSection` - замки и крепости

### Автоматически генерируемые
- `date` - дата создания
- `projectName` - название проекта
- `typeLower` - тип в нижнем регистре для тегов
- `imageBlock` - блок с изображением

## Интеграция с системой

### Связи с другими сущностями
- **Государства**: Провинция привязана к государству через поле `state`
- **Города**: Связь через поле `province` в записях городов
- **Деревни**: Связь через поле `province` в записях деревень
- **Фортификации**: Связь через поле `province` в записях фортификаций
- **Фракции**: Указана доминирующая и второстепенные фракции
- **Климаты**: Указан климат региона

### Dataview интеграция
- Автоматическое отображение всех связанных локаций
- Фильтрация по типу и провинции
- Исключение текущего файла из списков
- Поддержка тегов для фортификаций

## Пример использования

```javascript
// В createProvince.js
const data = {
    name: "Торвальд",
    type: "Провинция",
    climate: "Умеренный",
    state: "Королевство_1",
    dominantFaction: "Аристократия",
    historicalPeriod: "Средневековье",
    description: "Центральная провинция королевства...",
    population: "Около 50,000 жителей",
    economy: "Смешанная экономика: сельское хозяйство, торговля, ремёсла",
    minorFactionsSection: "- Гильдии торговцев\n- Церковь\n- Военные ордена",
    citiesSection: "- [[Хаген]] - столица провинции\n- [[Берген]] - торговый центр",
    villagesSection: "- [[Хряковка]] - сельскохозяйственная деревня",
    deadZonesSection: "- [[Тёмный лес]] - опасная территория",
    portsSection: "- [[Порт Торвальд]] - главный порт",
    castlesSection: "- [[Замок Торвальд]] - резиденция губернатора",
    date: "2025-08-11",
    projectName: "заявсь",
    typeLower: "провинция",
    imageBlock: "![[Теговые_картинки/Провинция.jpg]]"
};
```

## Особенности шаблона

### Административная структура
- Шаблон отражает административную иерархию: Государство → Провинция → Локации
- Включает все типы населённых пунктов и особых территорий
- Поддерживает сложные связи между сущностями

### Автоматические связи
- Провинция является центральным элементом для связывания локаций
- Все Dataview запросы автоматически обновляются при создании новых локаций
- Поддержка исключения текущего файла из списков

### Гибкость структуры
- Шаблон поддерживает как простые, так и сложные провинции
- Опциональные разделы позволяют адаптировать под конкретные нужды
- Статические разделы можно дополнить или изменить

## История изменений
- **2025-01-09**: Интеграция с ProvinceWizardModal
- **2024-12-19**: Добавлена поддержка изображений через imageBlock
- **2024-12-19**: Создана первая версия шаблона

## Зависимости
- `createProvince.js` - логика создания
- `ProvinceWizardModal.js` - мастер ввода данных
- `settingsService.js` - получение настроек мира
- `Теговые_картинки/Провинция.jpg` - изображение провинции
