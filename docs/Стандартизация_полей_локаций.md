# Стандартизация полей локаций

## Обзор
Документ описывает стандартизированную структуру полей для всех типов локаций в плагине Literary Templates.

## Обязательные поля (всегда должны быть)

### **Базовые поля:**
- `created: "{{date}}"` - дата создания
- `name: "{{name}}"` - название локации (единое поле для всех типов)
- `aliases: ["{{name}}"]` - альтернативные названия
- `type: "{{type}}"` - тип локации (динамическое значение)
- `tags: [place{{#if typeLower}}, {{typeLower}}{{/if}}, [тип], локация, активный]` - теги
- `project: "{{projectName}}"` - название проекта
- `state: "{{state}}"` - государство
- `province: "{{province}}"` - провинция
- `climate: "{{climate}}"` - климат
- `dominantFaction: "{{dominantFaction}}"` - доминирующая фракция (единое поле для всех)
- `status: "{{status}}"` - статус (действует, разрушен, etc.)

### **Хронологические поля:**
- `history:` - массив событий с годом и описанием
- `population_history:` - массив значений населения по годам

## Типы локаций и их специфичные поля

### **1. Город (City)**
- `mainIndustriesSection` - основные отрасли
- `districtsSection` - районы
- `uniqueFeaturesSection` - уникальные особенности

### **2. Деревня (Village)**
- `mainCrops` - основные культуры
- `crafts` - ремесла
- `features` - особенности

### **3. Замок (Castle)**
- `defense` - защита
- `garrison` - гарнизон

### **4. Порт (Port)**
- `harborType` - тип гавани
- `tradeRoutes` - торговые пути

### **5. Ферма (Farm)**
- `crops` - культуры
- `animals` - животные

### **6. Шахта (Mine)**
- `resources` - ресурсы
- `depth` - глубина

### **7. Завод (Factory)**
- `production` - продукция
- `technology` - технологии

### **8. Провинция (Province)**
- `minorFactionsSection` - второстепенные фракции
- `citiesSection` - города
- `villagesSection` - деревни

### **9. Государство (State)**
- `capital` - столица
- `population` - население

## Примеры использования

### **Город:**
```yaml
---
created: "2025-09-01"
name: "Велюгардия"
aliases: ["Велюгардия"]
type: "Город"
tags: [place, город, локация, активный]
project: "Тонущий_мир"
state: "Галиндия"
province: "Центральная"
climate: "Умеренный"
dominantFaction: "Аристократия"
status: "действует"
---
```

### **Деревня:**
```yaml
---
created: "2025-09-01"
name: "Зелёная Долина"
aliases: ["Зелёная Долина"]
type: "Деревня"
tags: [place, деревня, локация, активный]
project: "Тонущий_мир"
state: "Галиндия"
province: "Центральная"
climate: "Умеренный"
dominantFaction: "Крестьяне"
status: "действует"
---
```

## Преимущества стандартизации

### **1. Единообразие запросов**
```dataview
LIST FROM ""
WHERE tags AND contains(tags, "город") 
AND state = this.state
AND file.name != this.file.name
```

### **2. Простота поддержки**
- Все локации имеют одинаковую структуру
- Легко добавлять новые поля
- Простое создание новых типов локаций

### **3. Совместимость**
- Обратная совместимость со старыми файлами
- Поддержка как новых, так и старых названий полей
- Автоматическое преобразование в EntityFactory

## Миграция существующих файлов

### **Автоматическая миграция:**
EntityFactory автоматически преобразует старые названия полей в новые:
- `cityName` → `name`
- `villageName` → `name`
- `castleName` → `name`
- `faction` → `dominantFaction`

### **Ручная миграция:**
Для существующих файлов можно использовать поиск и замену:
- `villageName:` → `name:`
- `castleName:` → `name:`
- `faction:` → `dominantFaction:`

## Следующие шаги

1. **Обновить все шаблоны локаций** для соответствия стандарту
2. **Добавить валидацию** обязательных полей в EntityFactory
3. **Создать миграционные скрипты** для существующих файлов
4. **Добавить новые типы локаций** по стандарту
5. **Создать тесты** для проверки стандартизации

## Заключение

Стандартизация полей локаций значительно упрощает:
- Создание Dataview запросов
- Поддержку и развитие плагина
- Добавление новых типов локаций
- Совместимость между разными версиями

Все новые локации должны создаваться по этому стандарту, а существующие постепенно мигрировать к нему.
