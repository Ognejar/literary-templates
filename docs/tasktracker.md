# Трекер задач

## Задача: Сборщик — копирование шаблонов и диагностика
- **Статус**: ✅ Завершена
- **Описание**: Обновить `build.php`, чтобы при сборке автоматически копировались папки `templates` и `templates/sections` в целевую папку плагина. Добавить диагностические сообщения о размере итогового файла и отчёт по дубликатам.
- **Шаги выполнения**:
  - [x] Добавить функцию рекурсивного копирования `copyDir`
  - [x] Копировать `templates` и `templates/sections` в `C:\Obsidian_data_C\.obsidian\plugins\literary-templates\`
  - [x] Добавить диагностику: размер `main.bundle.js`, сравнение с суммой исходников
  - [x] Добавить простой отчёт по дублирующимся сигнатурам
  - [x] Пересобрать проект и проверить результат
- **Зависимости**: `build.php`, `templates/*`
- **Результат**: Шаблоны автоматически обновляются при сборке; сборка сопровождается понятным отчётом.

## Задача: Артефакт — создание общих секций и обновление шаблона
- **Статус**: ✅ Завершена
- **Описание**: Создать общие секции для всех документов и обновить шаблон артефакта на их использование.
- **Шаги выполнения**:
  - [x] Создать общую секцию `Шапка.md` для всех документов (изображение + заголовок)
  - [x] Создать общие секции: Магические_свойства, Ограничения_и_риски, Особенности, Способ_создания, Обслуживание, Владение_и_расположение
  - [x] Каждая секция содержит условные блоки `{{#if}}` для отображения только при наличии данных
  - [x] Обновить шаблон `Новый_артефакт.md`: заменить include-секции на общие секции
  - [x] Убрать дублирующую папку `Артефакт/` - теперь все секции общие
  - [x] Обновить документацию (changelog, tasktracker)
- **Зависимости**: `templates/Новый_артефакт.md`, `ArtifactWizardModal.js`
- **Результат**: Создана система общих секций для всех типов документов; устранено дублирование кода; шапка документов вынесена в отдельную секцию.

## Задача: Актуализация бандла и устранение ReferenceError для алхимии
- **Статус**: ✅ Завершена
- **Описание**: Обеспечить попадание актуальной onload-логики в активный `main.bundle.js` и доступность `window.createAlchemyRecipe`. Нормализовать генерацию алхимического рецепта: убрать `manual`, добавить `tagImage`, автопополнение справочников (категории/эффекты/теги).
- **Шаги выполнения**:
  - [x] Включить `AlchemyRecipeWizardModal.js` и `creators/createAlchemyRecipe.js` в сборку (`build.php`)
  - [x] Добавить `chdir(__DIR__)` в `build.php` для корректного запуска
  - [x] Обновить `AlchemyRecipeWizardModal.js`: генерация через `generateFromTemplate`, нормализация, `tagImage`, автосправочники, унификация UI (убрать дублирующие поля, кнопка «✓ Готово»)
  - [x] Обновить `createAlchemyRecipe.js`: передача `plugin` и корректные зависимости конструктора
  - [x] Пересобрать и скопировать бандл в папку плагина
- **Зависимости**: `main.js`, `templates/Новый_алхимический_рецепт.md`, `src/settingsService.js`
- **Результат**: Контекстное меню «Создать алхимический рецепт» работает без ReferenceError; созданные файлы корректно подставляют картинку, не содержат `manual` и пополняют справочники.

## Задача: Тонущий мир — нормализация структуры сущностей
- **Статус**: ✅ Завершена
- **Описание**: Привести расположение городов и провинций к стандартной структуре проекта.
- **Шаги выполнения**:
  - [x] Перенести города в `Локации/Города/` (`Любенбург`, `Велюмарк`, `Рюэн`, `Барраир`)
  - [x] Перенести `Велюградия.md` в `Провинции/`
  - [x] Удалить пустой дубликат `Локации/Гарданский Союз.md`
- **Зависимости**: Стандарты путей в `creators/*`
- **Результат**: Структура проекта соответствует правилам; внутренние ссылки работают штатно (имена заметок не менялись).
## Задача: Исправление предупреждений ESLint в main.js
- **Статус**: ✅ Завершена
- **Описание**: Устранить предупреждение `'_ is defined but never used'` на строке 214, заменив `catch (_){}` на `catch {}` в `getActiveEditor()`, а также убрать неиспользуемую переменную `fsError` в `processSingleInclude()`.
- **Шаги выполнения**:
  - [x] Обновить changelog с записью об исправлении
  - [x] Внести правку в `main.js` (`catch {}` вместо `catch (_){}`)
  - [x] Внести правку в `main.js` (`catch {}` вместо `catch (fsError){}`)
  - [x] Проверить линтер для файла
- **Зависимости**: Нет
- **Результат**: Все предупреждения ESLint в `main.js` устранены, поведение не изменено.

## Задача: Тонущий мир — изображения и очистка маркеров
- **Статус**: ✅ Завершена
- **Описание**: Добавить опциональные изображения в карточки и удалить служебные маркеры.
- **Шаги выполнения**:
  - [x] Вставить `![[Теговые_картинки/Город.webp]]` в карточки городов
  - [x] Вставить `![[Теговые_картинки/Провинция.webp]]` в `Провинции/Велюградия.md`
  - [x] Удалить `tp.file.cursor()` из всех `.md`
- **Зависимости**: Наличие базовых файлов в `Теговые_картинки`
- **Результат**: Карточки отображают изображения при наличии файлов, проект очищен от служебных вставок
## Задача: Автодобавление ингредиентов в справочник при создании зелья
- **Статус**: ✅ Завершена
- **Описание**: Добавить опцию и логику автоматического внесения новых ингредиентов (из ручного ввода) в `Магия/Справочники/Ингредиенты_зелий.md` при завершении мастера создания зелья.
- **Шаги выполнения**:
  - [x] Добавить флаг `addToReference` и переключатель в `PotionWizardModal.js`
  - [x] Реализовать чтение существующего справочника и слияние с новыми именами
  - [x] Сохранить обновленный список (сортированный) в `Ингредиенты_зелий.md`
  - [x] Обновить DocBlock и changelog
  - [x] Проверить линтер
- **Зависимости**: Структура проекта (`Магия/Справочники/`)
- **Результат**: Новые ингредиенты из мастера автоматически пополняют справочник (опционально, по умолчанию включено)

## Задача: Справочники для сложности и времени приготовления зелий
- **Статус**: ✅ Завершена
- **Описание**: Подключить справочники для сложности и времени приготовления. Обеспечить корректные формы сложности в женском роде.
- **Шаги выполнения**:
  - [x] Чтение `Сложности_зелий.md` и `Время_приготовления_зелий.md` в `PotionWizardModal.js`
  - [x] Дропдауны с опцией «Ввести вручную» для времени и сложности
  - [x] Подстановка ручных значений в `createPotion.js`
  - [x] Обновить changelog
- **Зависимости**: Наличие или создание файлов справочников в `Магия/Справочники/`
- **Результат**: В мастере доступны списки сложностей и времени приготовления; корректная подстановка значений

## Задача: Инструменты зельеварения — список и справочник
- **Статус**: ✅ Завершена
- **Описание**: Реализовать динамический список инструментов в мастере зелий с выпадающим списком из справочника и ручным вводом; добавлять новые инструменты в `Инструменты_зельеварения.md`.
- **Шаги выполнения**:
  - [x] Добавить чтение справочника инструментов в `PotionWizardModal.js`
  - [x] Реализовать `instrumentsList`, рендер списка и сбор в строку для шаблона
  - [x] Автодобавление инструментов в справочник в `createPotion.js`
  - [x] Обновить документацию
- **Зависимости**: Папка `Магия/Справочники/`
- **Результат**: Инструменты удобно задаются и фиксируются без дублей

## Задача: Завершение системы магических функций
- **Статус**: ✅ Завершена
- **Описание**: Реализовать все магические функции с модальными окнами мастера
- **Шаги выполнения**:
  - [x] Создать модальный мастер для артефактов (ArtifactWizardModal.js)
  - [x] Создать модальный мастер для алхимических рецептов (AlchemyRecipeWizardModal.js)
  - [x] Создать функцию создания артефактов (createArtifact.js)
  - [x] Создать функцию создания алхимических рецептов (createAlchemyRecipe.js)
  - [x] Обновить шаблон артефактов с новыми полями
  - [x] Создать новый шаблон алхимических рецептов
  - [x] Включить алхимические рецепты в контекстное меню
  - [x] Заменить старую функцию createArtifact на модульную версию
  - [x] Протестировать все магические функции
- **Зависимости**: Нет
- **Результат**: Все магические функции (зелья, заклинания, артефакты, алхимические рецепты) теперь имеют полноценные модальные окна мастера

## Задача: Система статусов для всех типов локаций
- **Статус**: ✅ Завершена
- **Описание**: Добавить систему статусов (действует/заброшено/разрушено) для всех типов локаций с условным отображением производственных характеристик
- **Шаги выполнения**:
  - [x] Реализовать систему статусов для ферм
  - [x] Реализовать систему статусов для шахт
  - [x] Реализовать систему статусов для заводов
  - [x] Реализовать систему статусов для мёртвых зон (по умолчанию заброшено)
  - [x] Реализовать систему статусов для городов
  - [x] Реализовать систему статусов для деревень
  - [x] Реализовать систему статусов для портов
  - [x] Реализовать систему статусов для замков/крепостей
  - [x] Реализовать систему статусов для локаций
  - [x] Обновить все шаблоны для поддержки статусов
  - [x] Добавить шаги статуса во все модальные окна
  - [x] Обновить функции создания для передачи данных о статусе
  - [x] Реализовать условное отображение секций в зависимости от статуса
- **Зависимости**: Нет
- **Результат**: Все типы локаций теперь имеют единообразную систему статусов с условным отображением производственных/экономических секций

## Задача: Команда "Вставить TODO для сущности"
- **Статус**: ✅ Завершена
- **Описание**: Создать команду для вставки TODO-заметок в текущий файл с автоматическим определением типа сущности
- **Шаги выполнения**:
  - [x] Создать функцию insertTodoAtCursor
  - [x] Добавить команду в main.js
  - [x] Реализовать определение типа сущности по frontmatter
  - [x] Создать шаблон TODO с автоматическими связями
  - [x] Протестировать работу команды
- **Зависимости**: Нет
- **Результат**: Команда успешно создает TODO-заметки с автоматическим определением типа сущности

## Задача: Команда "Вставить сюжетную линию в сцену"
- **Статус**: ✅ Завершена
- **Описание**: Создать команду для вставки сюжетных линий из файла Сюжетные_линии.md в текущую сцену
- **Шаги выполнения**:
  - [x] Создать функцию insertPlotlineIntoScene
  - [x] Добавить команду в main.js
  - [x] Реализовать парсинг файла Сюжетные_линии.md
  - [x] Создать шаблон для вставки сюжетной линии
  - [x] Протестировать работу команды
- **Зависимости**: Нет
- **Результат**: Команда успешно вставляет сюжетные линии в сцены

## Задача: Dataview отчеты в главный файл проекта
- **Статус**: ✅ Завершена
- **Описание**: Добавить Dataview отчеты в главный файл проекта для отслеживания прогресса
- **Шаги выполнения**:
  - [x] Создать отчет "Локации по статусам"
  - [x] Создать отчет "Невыполненные задачи"
  - [x] Создать отчет "Пустые карточки"
  - [x] Создать отчет "Города и провинции"
  - [x] Добавить отчеты в главный файл проекта
- **Зависимости**: Нет
- **Результат**: Главный файл проекта теперь содержит полезные отчеты для отслеживания прогресса

## Задача: Реструктуризация контекстного меню
- **Статус**: ✅ Завершена
- **Описание**: Реорганизовать контекстное меню плагина для лучшей навигации
- **Шаги выполнения**:
  - [x] Создать иерархическую структуру меню
  - [x] Сгруппировать команды по категориям
  - [x] Добавить разделители между разделами
  - [x] Переместить основные разделы в начало
  - [x] Переместить служебные функции в конец
- **Зависимости**: Нет
- **Результат**: Меню стало более логичным и удобным для навигации

## Задача: Исправление ошибок шаблонов и условных операторов
- **Статус**: ✅ Завершена
- **Описание**: Исправить проблемы с условными операторами и include-блоками в шаблонах
- **Шаги выполнения**:
  - [x] Исправить обработку условных операторов {{#if status == действует}}
  - [x] Удалить дублированные включения {{include:sections/История.md}}
  - [x] Исправить вложенные условные блоки
  - [x] Улучшить обработку include-блоков
  - [x] Заменить {{else if}} на независимые {{#if}} блоки
- **Зависимости**: Нет
- **Результат**: Шаблоны теперь корректно обрабатывают условные операторы и include-блоки

## Задача: Планирование оптимизации системы шаблонов
- **Статус**: ✅ Завершена
- **Описание**: Спланировать оптимизацию системы шаблонов для упрощения и унификации
- **Шаги выполнения**:
  - [x] Проанализировать текущую систему шаблонов
  - [x] Определить повторяющиеся секции
  - [x] Спланировать переход к include-блокам
  - [x] Создать план унификации шаблонов
  - [x] Документировать план оптимизации
- **Зависимости**: Нет
- **Результат**: Создан план оптимизации системы шаблонов

## Задача: Персонажи — мастер на HtmlWizardModal + секции
- **Статус**: ✅ Завершена
- **Описание**: Перевести создание персонажей на новый базовый класс модальных окон и общие секции.
- **Шаги выполнения**:
  - [x] Создать `CharacterWizardModal` на базе `HtmlWizardModal`
  - [x] Включить фолбэк подбора `tagImage` (Персонаж → character → по расе)
  - [x] Создать общие секции: `Шапка.md`, `Основная_информация.md`, `Описание.md`, `Особенности.md`, `Автоматические_связи.md`
  - [x] Обновить `Новый_персонаж.md` на include секции
  - [x] Активировать пункт меню «Создать персонажа»
- **Зависимости**: `main.js`, `CharacterWizardModal.js`, `templates/*`
- **Результат**: Единый стиль и генерация по шаблону, корректное изображение в шапке.

## Задача: Заклинания — мастер на HtmlWizardModal
- **Статус**: ✅ Завершена
- **Описание**: Перевести мастер заклинаний на `HtmlWizardModal` для унификации UI.
- **Шаги выполнения**:
  - [x] Обновить `SpellWizardModal.js`: наследование, прогресс-бар, кнопки, стили
  - [x] Пересобрать и проверить работу
- **Зависимости**: `HtmlWizardModal.js`, `SpellWizardModal.js`
- **Результат**: Унифицированный внешний вид и логика кнопок (← Назад / ✓ Готово).
