# Миграция существующего контента

## Проблема
У вас уже есть написанные главы в старой структуре, и нужно их интегрировать в новую систему эпох.

## Решение

### Вариант 1: Автоматическая миграция (Рекомендуется)

#### Шаг 1: Создание эпох
1. Откройте командную палитру → "Выбрать эпоху"
2. Создайте эпоху для вашего существующего произведения
3. Например: "Раннее Средневековье" (1000-1300)

#### Шаг 2: Миграция контента
1. Откройте командную палитру → "Мигрировать существующий контент"
2. Заполните форму:
   - **ID произведения:** краткий идентификатор (например, `main_novel`)
   - **Название произведения:** полное название
   - **Эпоха:** выберите созданную эпоху
3. Выберите главы для миграции
4. Нажмите "Начать миграцию"

#### Что происходит при миграции:
- Создается структура: `1_Рукопись/Произведения/[ID]/Главы/`
- Главы копируются с обновленным frontmatter
- Добавляется поле `epoch` в каждую главу
- Опционально удаляются оригинальные файлы

### Вариант 2: Ручная миграция

#### Шаг 1: Создание произведения
1. Создайте произведение через "Создать произведение"
2. Укажите эпоху и временной контекст

#### Шаг 2: Перемещение файлов
1. Вручную переместите главы в папку `1_Рукопись/Произведения/[ID]/Главы/`
2. Обновите frontmatter в каждой главе:
   ```yaml
   ---
   title: "Название главы"
   chapter: 1
   epoch: "Раннее_Средневековье"
   migrated: true
   ---
   ```

### Вариант 3: Гибридный подход

#### Для разных произведений:
1. **Первое произведение:** мигрируйте существующие главы
2. **Второе произведение:** создайте новое в другой эпохе
3. **Общие элементы:** оставьте в корне проекта

## Примеры миграции

### Сценарий 1: Одно произведение
```
До миграции:
1_Рукопись/Главы/
├── Глава_1.md
├── Глава_2.md
└── Глава_3.md

После миграции:
1_Рукопись/Произведения/main_novel/
├── main_novel.md
└── Главы/
    ├── Глава_01_Название_главы.md
    ├── Глава_02_Название_главы.md
    └── Глава_03_Название_главы.md
```

### Сценарий 2: Несколько произведений
```
До миграции:
1_Рукопись/Главы/
├── Роман_Глава_1.md
├── Роман_Глава_2.md
├── Рассказ_Глава_1.md
└── Рассказ_Глава_2.md

После миграции:
1_Рукопись/Произведения/
├── main_novel/
│   ├── main_novel.md
│   └── Главы/
│       ├── Глава_01_Роман_глава.md
│       └── Глава_02_Роман_глава.md
└── short_story/
    ├── short_story.md
    └── Главы/
        ├── Глава_01_Рассказ_глава.md
        └── Глава_02_Рассказ_глава.md
```

## Обновление frontmatter

### Старый формат:
```yaml
---
title: "Название главы"
chapter: 1
---
```

### Новый формат:
```yaml
---
title: "Название главы"
chapter: 1
epoch: "Раннее_Средневековье"
work: "main_novel"
migrated: true
originalPath: "1_Рукопись/Главы/Глава_1.md"
---
```

## Обновление Dataview запросов

### Старые запросы:
```dataview
TABLE title, chapter
FROM "1_Рукопись/Главы"
SORT chapter ASC
```

### Новые запросы:
```dataview
TABLE title, chapter
FROM "1_Рукопись/Произведения/main_novel/Главы"
SORT chapter ASC
```

## Обработка связей

### Автоматическое обновление:
- Ссылки между главами обновляются автоматически
- Dataview запросы в главах обновляются
- Ссылки на персонажей и локации сохраняются

### Ручное обновление:
- Проверьте все внутренние ссылки
- Обновите Dataview запросы в главах
- Проверьте ссылки на другие файлы

## Резервное копирование

### Перед миграцией:
1. Сделайте резервную копию всего проекта
2. Экспортируйте список всех файлов
3. Проверьте, что все главы сохранены

### После миграции:
1. Проверьте, что все главы мигрированы
2. Убедитесь, что ссылки работают
3. Протестируйте Dataview запросы

## Устранение неполадок

### Проблема: Главы не найдены
**Решение:** Проверьте пути поиска в `migrateExistingContent.js`

### Проблема: Frontmatter не обновляется
**Решение:** Проверьте формат YAML в главах

### Проблема: Ссылки не работают
**Решение:** Обновите относительные пути в ссылках

### Проблема: Dataview не работает
**Решение:** Обновите пути в Dataview запросах

## Лучшие практики

### Планирование миграции:
1. **Создайте резервную копию** перед началом
2. **Определите эпохи** для всех произведений
3. **Спланируйте структуру** произведений
4. **Протестируйте** на небольшом количестве файлов

### Выполнение миграции:
1. **Мигрируйте поэтапно** - по одному произведению
2. **Проверяйте результат** после каждого этапа
3. **Обновляйте ссылки** по мере необходимости
4. **Документируйте изменения**

### После миграции:
1. **Проверьте все ссылки** в мигрированных файлах
2. **Обновите Dataview запросы** в главных файлах
3. **Протестируйте функциональность** плагина
4. **Создайте новое произведение** для тестирования

## Альтернативные подходы

### Постепенная миграция:
- Мигрируйте только новые главы
- Старые главы оставьте в старой структуре
- Создавайте новые произведения в новой системе

### Параллельная работа:
- Работайте со старой и новой системой одновременно
- Постепенно переносите контент
- Используйте разные эпохи для разных произведений

### Полная перестройка:
- Создайте новый проект с новой структурой
- Перенесите контент вручную
- Используйте новую систему с самого начала
