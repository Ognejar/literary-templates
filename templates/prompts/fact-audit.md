---
title: "Аудит базы фактов"
description: "Глубокая проверка фактов: дубликаты, алиасы, множественная принадлежность, сироты, временные и логические противоречия, пробелы и конкретные рекомендации"
output: "markdown+json"
source: "facts_database"
---

# Аудит базы фактов

Проанализируй базу фактов проекта и подготовь подробный отчёт. Используй только русский язык. Будь конкретным: приводи точные названия сущностей и их поля.

## Контекст проекта
- Название проекта: {{projectName}}
- Тип проекта: {{projectType}}
- Дата аудита: {{currentDate}}

## Данные для анализа (JSON)
```
{{content}}
```

## Правила и проверки
1) Идентичность сущности: пара (тип, имя). Сравнение имени — регистронезависимое, без ведущих/замыкающих пробелов. Считать эквивалентными варианты с:
   - заменой «ё»→«е», «й»→«и»;
   - удалением дефисов/подчёркиваний/многих пробелов;
   - мелкими опечатками (ред. расстояние ≤ 2) — помечать как «возможные алиасы».
2) Дубликаты: одна и та же сущность (тип+нормализованное имя) встречается более 1 раза — объединить различия полей и указать расхождения.
3) Алиасы: разные записи, вероятно обозначающие одну сущность (см. п.1) — перечислить пары/группы кандидатов с коэффициентом похожести и отличиями.
4) Эксклюзивная принадлежность: 
   - «город», «провинция», «регион», «поселение» не могут одновременно принадлежать двум государствам.
   - Выводи список объектов с множественной принадлежностью (определи по атрибутам/отношениям: связи вида «принадлежит», «в составе», «часть», «столица», «провинция/государство», и т.п.).
5) Временные противоречия:
   - даты/периоды в полях (например: родился/умер, начало/конец, основан/разрушен) должны удовлетворять start ≤ end;
   - детектируй несостыковки (например, персонаж умер раньше рождения, правитель правил после свержения и т.п.).
6) Сироты/битые ссылки:
   - в «отношения» каждый «объект» должен указывать на существующую сущность; отсутствующие — вынести списком.
7) Обязательные поля (если применимо):
   - персонаж: как минимум одно из — возраст/дата рождения, статус/роль;
   - город: желательно государство/провинция;
   - государство: желательно столица/правитель;
   - артефакт: описательный атрибут (школа/эффект/материал). 
   Сообщай, где явно не хватает ключевых атрибутов.
8) Конфликтующие отношения: например, взаимоисключающие роли/связи («столица» двух стран сразу; взаимоисключающие статусы) — перечисли конкретные случаи.

## Отчёт (Markdown)
1. Итоги (сводка чисел):
   - Всего сущностей: N
   - Всего отношений: M
   - Дубликаты: k
   - Алиасы (возможные): a
   - Множественная принадлежность: p
   - Сироты (битые ссылки): o
   - Временные противоречия: t
   - Пропуски обязательных атрибутов: g

2. Дубликаты (точные по тип+нормализованное имя):
   - Для каждого: имя, сравнение атрибутов по ключам (что отличается), рекомендации по объединению.

3. Алиасы (возможные совпадения имён):
   - Для каждой группы: список вариантов имени, коэффициент похожести, различия, гипотеза «верное имя», рекомендация по унификации.

4. Множественная принадлежность:
   - Конкретные объекты и их конфликтующие владельцы/принадлежности, где обнаружено.

5. Сироты и битые ссылки:
   - Список ссылок «тип/имя/ID», на которые есть отношение, но нет определения.

6. Временные противоречия:
   - Конкретные сущности, поля, значения и причина конфликта.

7. Пропуски/полнота атрибутов:
   - Перечисли сущности и недостающие ключевые атрибуты (с учётом правил выше), приоритизируй по важности.

8. Рекомендации (конкретные шаги):
   - Список чётких действий: «Переименовать X→Y», «Объединить записи A и B (сохранить атрибуты …)», «Установить ‘государство: Z’ для города Y», «Создать сущность для битой ссылки …», «Уточнить дату …» и т.п.

## JSON-резюме (добавь после отчёта)
```json
{
  "aliases": [
    { "тип": "", "имена": [""], "confidence": 0.0, "differences": {"атрибут": ["A","B"]} }
  ],
  "duplicates": [
    { "тип": "", "имя": "", "entries": 2, "differences": {"атрибут": ["A","B"]} }
  ],
  "multi_ownership": [
    { "объект": "", "владельцы": [""] }
  ],
  "orphans": [
    { "ссылка": { "связь": "", "объект": "" }, "где": { "тип": "", "имя": "" } }
  ],
  "temporal_conflicts": [
    { "сущность": {"тип": "", "имя": ""}, "поле": "", "значения": {"start": "", "end": ""} }
  ],
  "missing_attributes": [
    { "тип": "", "имя": "", "нужно": [""] }
  ],
  "fix_plan": ["…"]
}
```

---

Промпт для внешнего AI-сервиса. Сосредоточься на конкретике, не давай расплывчатых рекомендаций. Если чего-то не хватает, предлагай, какие факты добавить в явном виде.
