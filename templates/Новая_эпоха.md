<%*
const projectRootPath = tp.file.find_tfile('Настройки_мира.md')?.parent?.path || '';
const erasFolder = `${projectRootPath}/Хронология`;
const eraName = await tp.system.prompt('Название эпохи/периода?');
const startDate = await tp.system.prompt('Дата начала (например, 1200 до н.э. или 1453)?');
const endDate = await tp.system.prompt('Дата окончания (оставьте пустым, если эпоха продолжается)?');
const description = await tp.system.prompt('Краткое описание эпохи?');
const keyEvents = await tp.system.prompt('Ключевые события (через запятую)?');
const politicalChanges = await tp.system.prompt('Политические изменения?');
const culturalShifts = await tp.system.prompt('Культурные сдвиги?');
const consequences = await tp.system.prompt('Последствия/итоги?');
const cleanName = eraName.replace(/[/\\?%*:|"<>]/g, '').replace(/\s+/g, '_');
const newFullFileName = `${erasFolder}/${cleanName}.md`;
if (await app.vault.adapter.exists(newFullFileName)) {
  new Notice('Файл эпохи уже существует!');
  throw 'Файл эпохи уже существует!';
}
await tp.file.create_new('', newFullFileName);
tR += `---\ncreated: ${tp.date.now('YYYY-MM-DD')}\nname: ${eraName}\ntype: Эпоха\nstart: ${startDate}\nend: ${endDate}\ntags: [era, chronology]\n---\n\n# ${eraName}\n\n**Период:** ${startDate} — ${endDate || 'настоящее время'}\n\n## Описание\n${description}\n\n## Ключевые события\n${keyEvents}\n\n## Политические изменения\n${politicalChanges}\n\n## Культурные сдвиги\n${culturalShifts}\n\n## Последствия\n${consequences}\n\n## Автоматические связи\n### События эпохи\n\`\`\`dataview\nLIST FROM #event\nWHERE (contains(file.outlinks, [[${eraName}]] ) OR contains(file.tags, "${eraName}") OR regexmatch(file.text, "#${eraName}") OR regexmatch(file.text, "\\[\\[${eraName}(\\||\\]\\])"))\n\`\`\`\n\n### Государства эпохи\n\`\`\`dataview\nLIST FROM #state OR #country\nWHERE (contains(file.outlinks, [[${eraName}]] ) OR contains(file.tags, "${eraName}") OR regexmatch(file.text, "#${eraName}") OR regexmatch(file.text, "\\[\\[${eraName}(\\||\\]\\])"))\n\`\`\`\n\n### Народы эпохи\n\`\`\`dataview\nLIST FROM #people\nWHERE (contains(file.outlinks, [[${eraName}]] ) OR contains(file.tags, "${eraName}") OR regexmatch(file.text, "#${eraName}") OR regexmatch(file.text, "\\[\\[${eraName}(\\||\\]\\])"))\n\`\`\`\n\n### Локации эпохи\n\`\`\`dataview\nLIST FROM #place\nWHERE (contains(file.outlinks, [[${eraName}]] ) OR contains(file.tags, "${eraName}") OR regexmatch(file.text, "#${eraName}") OR regexmatch(file.text, "\\[\\[${eraName}(\\||\\]\\])"))\n\`\`\`\n`;
%>